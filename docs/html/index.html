<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arduino FatFS: Arduino-FatFs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Arduino FatFS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Arduino-FatFs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> There are quite a few SD Arduino libraries out there: the most important is the <a href="https://github.com/arduino-libraries/SD">SD.h provided by Arduino</a> which is a wrapper for <a href="https://github.com/greiman/SdFat">SdFat from Bill Greiman</a> which itself is quite friendly, powerfull and fast.</p>
<p>Bill's library provides some alternative SPI drivers to access the SD functionality, but it does not provide the functionality to store the data anywhere else and you can't use multiple SD drives that are attached to different SPI ports.</p>
<p>I am providing the <a href="http://elm-chan.org/fsw/ff/00index_e.html">FatFs library</a> developed by ChaN that I have converted to C++ classes so that we can flexibly support multiple data access drivers and scenarios at the same time.</p>
<p>The advantage of this library is that it provides quite a few configuration options and has a flexible driver concept, so that we can store the data potentially on the SD, in SPI RAM, RAM, PSRAM etc...</p>
<p>The FatFs library stops at the driver interfaces and does not provide any implementation.</p>
<p>I have added the most important drivers to this project: The drivers are written in a flexible way and do not use any predefed fixed pins or ports: e.g. on the SPI driver you can assign the pins as part of SPI, define the CS pin and assign your desired SPI object (e.g. SPI, SPI1, SPI2 etc).</p>
<p>We currently provide the following implementations:</p>
<ul>
<li>The data is stored in RAM (or PSRAM) (RamIO)</li>
<li>SD via Arduino SPI (SDArduinoSPIIO)</li>
<li>SD via Arduino GPIO using Bitbang (SDBitBangSPIIO)</li>
<li>Arduino Stream class (StreamIO) which needs to support the following additonal methods:<ul>
<li>begin()</li>
<li>seek()</li>
<li>sectorCount()</li>
<li>eraseSector(from, to)</li>
</ul>
</li>
<li>Support for multiple drives with different drivers (MultiIO)</li>
</ul>
<p>It is very easy to add new drivers...</p>
<h1><a class="anchor" id="autotoc_md1"></a>
SPI SD</h1>
<p>Here is an example of setting up a SD drive using the Arduino ESP32 SPI API:</p>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;SPI.h&quot;</div>
<div class="line">#include &quot;fatfs.h&quot;</div>
<div class="line"> </div>
<div class="line">#define MISO 12</div>
<div class="line">#define MOSI 13</div>
<div class="line">#define SCLK 14</div>
<div class="line">#define CS   15</div>
<div class="line"> </div>
<div class="line">SDArduinoSPIIO drv{CS, SPI}; // SD driver managing CS and assign SPI</div>
<div class="line">File file;</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">    // start SPI and setup pins</div>
<div class="line">    SPI.begin(SCLK, MISO, MOSI);</div>
<div class="line">    // start SD </div>
<div class="line">    SD.begin(drv); </div>
<div class="line"> </div>
<div class="line">    file = SD.open(&quot;test&quot;);</div>
<div class="line">    Serial.println(file.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {}</div>
</div><!-- fragment --><p> This example demonstates the most generic way to set up things. Of cause it is still possible to do it the way the Arduino SD library posposes (and you don't need to define a driver for using SD SPI yourself): just call <code>SD.begin(CS);</code></p>
<h1><a class="anchor" id="autotoc_md2"></a>
RAM Drive</h1>
<p>Here is an example of setting up a SD drive in RAM:</p>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;SPI.h&quot;</div>
<div class="line">#include &quot;fatfs.h&quot;</div>
<div class="line"> </div>
<div class="line">RamIO drv{100, 512}; // 100 sector with 512 bytes</div>
<div class="line">File file;</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">    // start SD </div>
<div class="line">    SD.begin(drv); </div>
<div class="line"> </div>
<div class="line">    file = SD.open(&quot;test&quot;);</div>
<div class="line">    Serial.println(file.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Mutliple Drives</h1>
<p>You can also use your own separate SDClass instances:</p>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;SPI.h&quot;</div>
<div class="line">#include &quot;fatfs.h&quot;</div>
<div class="line"> </div>
<div class="line">#define MISO 12</div>
<div class="line">#define MOSI 13</div>
<div class="line">#define SCLK 14</div>
<div class="line">#define CS   15</div>
<div class="line"> </div>
<div class="line">SDArduinoSPIIO sd{CS, SPI}; // driver managing CS and assign SPI</div>
<div class="line">RamIO mem{100, 512}; // 100 sector with 512 bytes</div>
<div class="line">SDClass sd_sd{sd}; // SD and assign driver</div>
<div class="line">SDClass sd_mem{mem};</div>
<div class="line">File file;</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">    // start SPI and setup pins</div>
<div class="line">    SPI.begin(SCLK, MISO, MOSI);</div>
<div class="line"> </div>
<div class="line">    // start SD </div>
<div class="line">    sd_mem.begin(); </div>
<div class="line">    sd_sd.begin(); </div>
<div class="line"> </div>
<div class="line">    auto file1 = sd_mem.open(&quot;0:test&quot;);</div>
<div class="line">    Serial.println(file1.size());</div>
<div class="line">    auto file2 = sd_sd.open(&quot;1:test&quot;);</div>
<div class="line">    Serial.println(file2.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {}</div>
</div><!-- fragment --><p>Here is an example of setting up a multi drive scenario using the MultiIO diver:</p>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;SPI.h&quot;</div>
<div class="line">#include &quot;fatfs.h&quot;</div>
<div class="line">#include &quot;driver/SDArduinoSPIIO.h&quot;</div>
<div class="line">#include &quot;driver/RamIO.h&quot;</div>
<div class="line">#include &quot;driver/MultiIO.h&quot;</div>
<div class="line"> </div>
<div class="line">#define MISO 12</div>
<div class="line">#define MOSI 13</div>
<div class="line">#define SCLK 14</div>
<div class="line">#define CS   15</div>
<div class="line"> </div>
<div class="line">SDArduinoSPIIO sd{CS, SPI}; // driver managing CS and assign SPI</div>
<div class="line">RamIO mem{100, 512}; // 100 sector with 512 bytes</div>
<div class="line">MultiIO drv;</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">    // start SPI and setup pins</div>
<div class="line">    SPI.begin(SCLK, MISO, MOSI);</div>
<div class="line"> </div>
<div class="line">    // setup MultiIO</div>
<div class="line">    drv.add(sd);</div>
<div class="line">    drv.add(mem);</div>
<div class="line"> </div>
<div class="line">    // start all drives </div>
<div class="line">    SD.begin(drv); </div>
<div class="line"> </div>
<div class="line">    auto file1 = SD.open(&quot;0:test&quot;);</div>
<div class="line">    Serial.println(file1.size());</div>
<div class="line">    auto file2 = SD.open(&quot;1:test&quot;);</div>
<div class="line">    Serial.println(file2.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Documentaion</h1>
<ul>
<li><a href="https://www.arduino.cc/reference/en/libraries/sd/">Arduino SD API</a></li>
<li><a href="http://elm-chan.org/fsw/ff/00index_e.html">FatFS Documentation</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
