<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arduino FatFS: Arduino-FatFs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Arduino FatFS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Arduino-FatFs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> There are quite a few SD Arduino libraries out there: the most important is the <a href="https://github.com/arduino-libraries/SD">SD.h provided by Arduino</a> which is a wrapper for <a href="https://github.com/greiman/SdFat">SdFat from Bill Greiman</a> which itself is quite friendly, powerfull and fast.</p>
<p>Bill's library provides some alternative SPI drivers to access the SD functionality, but it does not provide the functionality to store the data anywhere else and you can't use multiple SD drives that are attached to different SPI ports.</p>
<p>I am providing the <a href="http://elm-chan.org/fsw/ff/00index_e.html">FatFs library</a> developed by ChaN that I have converted to C++ header only so that we can flexibly support multiple data access drivers and scenarios at the same time.</p>
<p>The advantage of this library is, that it provides quite a few <b><a href="http://elm-chan.org/fsw/ff/doc/config.html#use_mkfs">configuration options</a></b> and has a flexible <b>driver concept</b>, so that we can store the data potentially on the SD, in SPI RAM, RAM, PSRAM etc. The FatFs library stops at the driver interface and does not provide any implementation.</p>
<p>I have added the most important drivers to this project: The drivers are written in a flexible way and do not use any predefed fixed pins or ports: e.g. on the SPI driver you can assign the pins as part of SPI, define the CS pin and assign your desired SPI object (e.g. SPI, SPI1, SPI2 etc). We currently provide the following <b>driver implementations</b>:</p>
<ul>
<li>The data is stored in <b>RAM (or PSRAM)</b> (RamIO)</li>
<li>Support for <b>multiple drives</b> with different drivers (MultiIO)</li>
<li>SD via Arduino <b>SPI</b> (SDArduinoSPIIO)</li>
</ul>
<p>It is very easy to add new drivers, so any contribution will be welcome...</p>
<h1><a class="anchor" id="autotoc_md1"></a>
SPI SD</h1>
<p>Here is an example of setting up a SD drive using the Arduino ESP32 SPI API:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;SPI.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fatfs.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MISO 12</span></div>
<div class="line"><span class="preprocessor">#define MOSI 13</span></div>
<div class="line"><span class="preprocessor">#define SCLK 14</span></div>
<div class="line"><span class="preprocessor">#define CS   15</span></div>
<div class="line"> </div>
<div class="line">SDArduinoSPIIO drv{CS, SPI}; <span class="comment">// SD driver managing CS and assign SPI</span></div>
<div class="line">File file;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// start SPI and setup pins</span></div>
<div class="line">    SPI.begin(SCLK, MISO, MOSI);</div>
<div class="line">    <span class="comment">// start SD </span></div>
<div class="line">    SD.begin(drv); </div>
<div class="line"> </div>
<div class="line">    file = SD.open(<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line">    Serial.println(file.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {}</div>
</div><!-- fragment --><p> This example demonstates the most generic way to set up things. Of cause it is still possible to do it the way the Arduino SD library posposes (and you don't need to define a driver for using SD SPI yourself): just call <code>SD.begin(CS);</code></p>
<h1><a class="anchor" id="autotoc_md2"></a>
RAM Drive</h1>
<p>Here is an example of setting up a SD drive in RAM:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;SPI.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fatfs.h&quot;</span></div>
<div class="line"> </div>
<div class="line">RamIO drv{100, 512}; <span class="comment">// 100 sector with 512 bytes</span></div>
<div class="line">File file;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// start SD </span></div>
<div class="line">    SD.begin(drv); </div>
<div class="line"> </div>
<div class="line">    file = SD.open(<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line">    Serial.println(file.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Mutliple Drives</h1>
<p>You can also use your own separate SDClass instances:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;SPI.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fatfs.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MISO 12</span></div>
<div class="line"><span class="preprocessor">#define MOSI 13</span></div>
<div class="line"><span class="preprocessor">#define SCLK 14</span></div>
<div class="line"><span class="preprocessor">#define CS   15</span></div>
<div class="line"> </div>
<div class="line">SDArduinoSPIIO sd{CS, SPI}; <span class="comment">// driver managing CS and assign SPI</span></div>
<div class="line">RamIO mem{100, 512}; <span class="comment">// 100 sector with 512 bytes</span></div>
<div class="line">SDClass sd_sd{sd}; <span class="comment">// SD and assign driver</span></div>
<div class="line">SDClass sd_mem{mem};</div>
<div class="line">File file;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// start SPI and setup pins</span></div>
<div class="line">    SPI.begin(SCLK, MISO, MOSI);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// start SD </span></div>
<div class="line">    sd_mem.begin(); </div>
<div class="line">    sd_sd.begin(); </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> file1 = sd_mem.open(<span class="stringliteral">&quot;0:test&quot;</span>);</div>
<div class="line">    Serial.println(file1.size());</div>
<div class="line">    <span class="keyword">auto</span> file2 = sd_sd.open(<span class="stringliteral">&quot;1:test&quot;</span>);</div>
<div class="line">    Serial.println(file2.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {}</div>
</div><!-- fragment --><p>Here is an example of setting up a multi drive scenario using the MultiIO diver:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;SPI.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fatfs.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/SDArduinoSPIIO.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/RamIO.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/MultiIO.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MISO 12</span></div>
<div class="line"><span class="preprocessor">#define MOSI 13</span></div>
<div class="line"><span class="preprocessor">#define SCLK 14</span></div>
<div class="line"><span class="preprocessor">#define CS   15</span></div>
<div class="line"> </div>
<div class="line">SDArduinoSPIIO sd{CS, SPI}; <span class="comment">// driver managing CS and assign SPI</span></div>
<div class="line">RamIO mem{100, 512}; <span class="comment">// 100 sector with 512 bytes</span></div>
<div class="line">MultiIO drv;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// start SPI and setup pins</span></div>
<div class="line">    SPI.begin(SCLK, MISO, MOSI);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// setup MultiIO</span></div>
<div class="line">    drv.add(sd);</div>
<div class="line">    drv.add(mem);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// start all drives </span></div>
<div class="line">    SD.begin(drv); </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> file1 = SD.open(<span class="stringliteral">&quot;0:test&quot;</span>);</div>
<div class="line">    Serial.println(file1.size());</div>
<div class="line">    <span class="keyword">auto</span> file2 = SD.open(<span class="stringliteral">&quot;1:test&quot;</span>);</div>
<div class="line">    Serial.println(file2.size());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Documentaion</h1>
<ul>
<li><a href="https://www.arduino.cc/reference/en/libraries/sd/">Arduino SD API</a></li>
<li><a href="http://elm-chan.org/fsw/ff/00index_e.html">FatFS Documentation</a></li>
<li>Class Documentation<ul>
<li><a href="https://pschatzmann.github.io/arduino-fatfs/html/group__sd.html">Arduino API</a></li>
<li><a href="https://pschatzmann.github.io/arduino-fatfs/html/classfatfs_1_1FatFs.html">FatFs API</a></li>
<li><a href="https://pschatzmann.github.io/arduino-fatfs/html/group__io.html">Media Access</a> </li>
</ul>
</li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
